<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç¾Šç¾Šå°ˆç”¨æ’ç­ç³»çµ±ï¼ˆä¾†è‡ªæ»¾æ»¾çš„â¤ï¸ï¼‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-50 p-6 min-h-screen">

    <div id="editModal" class="edit-modal">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-96">
            <h3 class="text-lg font-bold mb-4 border-b pb-2">ç·¨è¼¯äººå“¡è³‡è¨Š</h3>
            <input type="hidden" id="edit-id">
            <div class="space-y-4">
                <input id="edit-name" type="text" class="w-full border p-2 rounded" placeholder="å§“å">
                <div class="grid grid-cols-2 gap-2 text-sm">
                    <label class="flex items-center p-2 bg-slate-50 rounded"><input type="checkbox" class="role-checkbox-edit mr-2" data-role="isLeader"> Leader</label>
                    <label class="flex items-center p-2 bg-slate-50 rounded"><input type="checkbox" class="role-checkbox-edit mr-2" data-role="isIntern"> å¯¦ç¿’ç”Ÿ</label>
                    <label class="flex items-center p-2 bg-slate-50 rounded"><input type="checkbox" class="role-checkbox-edit mr-2" data-role="isUnready"> æœªç¨ç«‹</label>
                    <label class="flex items-center p-2 bg-slate-50 rounded"><input type="checkbox" class="role-checkbox-edit mr-2" data-role="isSupport"> æ”¯æ´</label>
                </div>
            </div>
            <div class="flex justify-end gap-2 mt-6">
                <button onclick="closeEdit()" class="px-4 py-2 bg-slate-100 rounded">å–æ¶ˆ</button>
                <button onclick="saveEdit()" class="px-4 py-2 bg-indigo-600 text-white rounded">å„²å­˜</button>
            </div>
        </div>
    </div>

    <div id="batchEditModal" class="edit-modal">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-[90vw] max-h-[80vh] flex flex-col">
            <h3 class="text-lg font-bold mb-2 border-b pb-2">ğŸ“… æ‰¹æ¬¡ç·¨è¼¯éå¾€ç­è¡¨ (14-20è™Ÿ)</h3>
            <p class="text-xs text-slate-500 mb-4">åœ¨æ­¤ä¿®æ”¹ä¸æœƒè§¸ç™¼é é¢è·³è½‰ï¼Œå®Œæˆå¾Œè«‹é»æ“Šä¸‹æ–¹ã€Œå„²å­˜å…¨éƒ¨è®Šæ›´ã€ã€‚</p>
            
            <div class="overflow-auto flex-1 border rounded">
                <table class="w-full text-sm border-collapse">
                    <thead class="sticky top-0 bg-slate-100">
                        <tr id="batch-header"></tr>
                    </thead>
                    <tbody id="batch-body"></tbody>
                </table>
            </div>
    
            <div class="flex justify-between items-center mt-6">
                <button onclick="clearBatchSelects()" class="px-4 py-2 bg-rose-100 text-rose-600 rounded font-bold hover:bg-rose-200 transition">æ¸…ç©ºå…¨éƒ¨ (è¨­ç‚ºOFF)</button>
                <div class="flex gap-2">
                    <button onclick="closeBatchEdit()" class="px-4 py-2 bg-slate-100 rounded">å–æ¶ˆ</button>
                    <button onclick="saveBatchEdit()" class="px-6 py-2 bg-indigo-600 text-white rounded font-bold shadow-lg">ğŸ’¾ å„²å­˜å…¨éƒ¨è®Šæ›´</button>
                </div>
            </div>
            
        </div>
    </div>

    <div class="max-w-[98vw] mx-auto space-y-6">
        <div class="bg-white p-6 rounded-xl shadow-md border border-slate-200">
            <div class="flex flex-wrap gap-8 items-start">
                <div class="flex-1">
                    <h2 class="text-xl font-bold mb-4 text-slate-700">ğŸ¥ ç¾Šç¾Šå°ˆç”¨æ’ç­ç³»çµ±ï¼ˆä¾†è‡ªæ»¾æ»¾çš„â¤ï¸ï¼‰</h2>
                    <div class="flex gap-4 items-end mb-6 bg-blue-50 p-4 rounded-xl">
                        <div>
                            <label class="block text-[10px] font-bold text-blue-800">å¹´ä»½</label>
                            <input id="set-year" type="number" class="border p-2 rounded w-24 font-bold" oninput="initDates()">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-blue-800">æœˆä»½</label>
                            <select id="set-month" class="border p-2 rounded w-24 font-bold" onchange="initDates()">
                                <option value="1">1æœˆ</option><option value="2">2æœˆ</option><option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option><option value="5">5æœˆ</option><option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option><option value="8">8æœˆ</option><option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option><option value="11">11æœˆ</option><option value="12">12æœˆ</option>
                            </select>
                        </div>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                        <div class="flex flex-wrap gap-4 items-end">
                            <input id="n-name" type="text" class="border p-2 rounded text-sm w-40" placeholder="è¼¸å…¥å§“å">
                            <div class="grid grid-cols-2 gap-2 text-[10px]">
                                <label><input type="checkbox" class="role-checkbox-new" data-role="isLeader"> Leader</label>
                                <label><input type="checkbox" class="role-checkbox-new" data-role="isIntern"> å¯¦ç¿’ç”Ÿ</label>
                                <label><input type="checkbox" class="role-checkbox-new" data-role="isUnready"> æœªç¨ç«‹</label>
                                <label><input type="checkbox" class="role-checkbox-new" data-role="isSupport"> æ”¯æ´</label>
                            </div>
                            <button onclick="addNurse()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold">æ–°å¢äººå“¡</button>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-50 p-5 rounded-xl min-w-[320px]">
                    <h2 class="text-sm font-bold mb-3">ğŸ“Š å€‹ç­åˆ¥äººåŠ›éœ€æ±‚è¨­å®š</h2>
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div class="text-center">D <input id="req-D" type="number" value="6" class="w-full border p-1 rounded text-center" onchange="updateStats()"></div>
                        <div class="text-center">E <input id="req-E" type="number" value="5" class="w-full border p-1 rounded text-center" onchange="updateStats()"></div>
                        <div class="text-center">N <input id="req-N" type="number" value="3" class="w-full border p-1 rounded text-center" onchange="updateStats()"></div>
                    </div>
                    <div class="text-[10px] text-slate-500 italic">â€» å…¬å‡ºç­ä¸è¨ˆå…¥ä»¥ä¸Šè‡¨åºŠäººåŠ›</div>
                    <div class="p-4 bg-slate-50 border rounded-lg shadow-inner mb-4">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 items-end">
                            <div class="bg-white p-3 rounded border shadow-sm">
                                <label class="block text-xs font-bold text-slate-500 mb-2">ğŸ¥ å…¨å–®ä½ç¸½åºŠæ•¸</label>
                                <input type="number" id="total-beds" value="43" oninput="updateStats()" class="w-full p-2 border rounded font-bold text-lg text-slate-700">
                            </div>
                    
                            <div class="col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="p-3 bg-blue-50 rounded border border-blue-100 flex flex-col justify-between">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-xs text-blue-600 font-bold">D ç­ç¸½è¦½</span>
                                        <span class="text-[10px] bg-blue-200 text-blue-700 px-2 py-0.5 rounded-full">éœ€æ±‚: <span id="display-req-D">6</span> äºº</span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="flex-1">
                                            <label class="text-[9px] text-slate-400 block">L è² è²¬åºŠæ•¸</label>
                                            <input type="number" id="l-beds-D" value="3" oninput="updateStats()" class="w-full p-1 border rounded">
                                        </div>
                                        <div class="text-right">
                                            <label class="text-[9px] text-slate-400 block">é ä¼°è­·ç—…æ¯”</label>
                                            <div id="ratio-D" class="text-lg font-black text-blue-700 leading-tight">1:8.0</div>
                                        </div>
                                    </div>
                                </div>
                    
                                <div class="p-3 bg-amber-50 rounded border border-amber-100 flex flex-col justify-between">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-xs text-amber-600 font-bold">E ç­ç¸½è¦½</span>
                                        <span class="text-[10px] bg-amber-200 text-amber-700 px-2 py-0.5 rounded-full">éœ€æ±‚: <span id="display-req-E">5</span> äºº</span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="flex-1">
                                            <label class="text-[9px] text-slate-400 block">L è² è²¬åºŠæ•¸</label>
                                            <input type="number" id="l-beds-E" value="5" oninput="updateStats()" class="w-full p-1 border rounded">
                                        </div>
                                        <div class="text-right">
                                            <label class="text-[9px] text-slate-400 block">é ä¼°è­·ç—…æ¯”</label>
                                            <div id="ratio-E" class="text-lg font-black text-amber-700 leading-tight">1:9.5</div>
                                        </div>
                                    </div>
                                </div>
                    
                                <div class="p-3 bg-purple-50 rounded border border-purple-100 flex flex-col justify-between">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-xs text-purple-600 font-bold">N ç­ç¸½è¦½</span>
                                        <span class="text-[10px] bg-purple-200 text-purple-700 px-2 py-0.5 rounded-full">éœ€æ±‚: <span id="display-req-N">3</span> äºº</span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="flex-1">
                                            <label class="text-[9px] text-slate-400 block">L è² è²¬åºŠæ•¸</label>
                                            <input type="number" id="l-beds-N" value="10" oninput="updateStats()" class="w-full p-1 border rounded">
                                        </div>
                                        <div class="text-right">
                                            <label class="text-[9px] text-slate-400 block">é ä¼°è­·ç—…æ¯”</label>
                                            <div id="ratio-N" class="text-lg font-black text-purple-700 leading-tight">1:16.5</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
            <div id="nurse-pool-display" class="flex flex-wrap gap-2 mt-6"></div>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-slate-800">ğŸ“… æœ¬æœˆç­è¡¨ (<span id="range-text"></span>)</h2>
                <div class="flex gap-2">
                    <button onclick="autoFillSmart()" class="bg-emerald-600 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-emerald-700 transition">ğŸª„ ä¸€éµæ’ç­</button>
                    <button onclick="toggleMode()" id="mode-btn" class="bg-rose-500 text-white px-4 py-2 rounded-lg font-bold">é€²å…¥é å‡æ¨¡å¼</button>
                    <button onclick="openBatchEdit()" class="bg-amber-500 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-amber-600 transition">ä¿®æ”¹ä¸Šæœˆç­è¡¨</button>
                    <button onclick="clearScheduleOnly()" class="bg-white border-rose-200 text-rose-500 border-2 px-4 py-2 rounded-lg font-bold">æ¸…ç©ºç­è¡¨</button>
                    <button onclick="exportToXls()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-blue-700 transition">ğŸ“¥ åŒ¯å‡ºExcel</button>
                </div>
                <div class="flex gap-2">
                    <button onclick="exportSchedule()" class="bg-blue-600 text-white px-3 py-1 rounded shadow hover:bg-blue-700">åŒ¯å‡ºç­è¡¨</button>
                    <input type="file" id="importFile" style="display:none" onchange="importSchedule(event)">
                    <button onclick="document.getElementById('importFile').click()" class="bg-emerald-600 text-white px-3 py-1 rounded shadow hover:bg-emerald-700">åŒ¯å…¥ç­è¡¨</button>
                </div>
            </div>

            <div class="bg-indigo-50 p-5 rounded-xl mb-6 flex flex-wrap items-end gap-4 shadow-inner">
                <select id="pool-select" class="border p-2 rounded-lg bg-white min-w-[180px]"></select>
                <select id="select-shift" class="border p-2 rounded-lg bg-white font-bold">
                    <option value=" "> - </option><option value="D">D (æ—©)</option><option value="E">E (å°å¤œ)</option><option value="N">N (å¤§å¤œ)</option><option value="OUT">å…¬ (å…¬å‡º)</option><option value="FLOW">FLOW</option><option value="OFF">OFF</option>
                </select>
                <button onclick="addToSchedule()" class="bg-indigo-600 text-white px-8 py-2 rounded-lg font-bold">åŠ å…¥ç­è¡¨</button>
            </div>

            <div id="table-wrapper" class="overflow-x-auto rounded-xl border border-slate-300">
                <table class="w-full border-collapse text-sm">
                    <thead><tr id="t-header" class="bg-slate-800 text-white"></tr></thead>
                    <tbody id="t-body" class="bg-white"></tbody>
                    <tfoot id="t-foot" class="bg-slate-50"></tfoot>
                </table>
            </div>
        </div>
    </div>
    <!-- Javascript é€£çµ -->
    <script src="script.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    
    <!-- firbaseè³‡æ–™åº« -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";
      
        // é€™è£¡è²¼ä¸Šä½ åœ¨ Firebase Console çœ‹åˆ°çš„ config
        const firebaseConfig = {
            apiKey: "AIzaSyDM2QRGz1uvwnyyZQGBgmplm7NYrrThbsU",
            authDomain: "nurseschedule-79425.firebaseapp.com",
            projectId: "nurseschedule-79425",
            storageBucket: "nurseschedule-79425.firebasestorage.app",
            messagingSenderId: "757085358020",
            appId: "1:757085358020:web:f19591794fc61762984691",
            measurementId: "G-1HGSJ78TZ9"
        };
      
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
      
        console.log("Firebase SDK å°±ç·’");
            if (typeof init === 'function') {
                init(); 
            } else {
                // å¦‚æœ script.js è¼‰å…¥è¼ƒæ…¢ï¼Œå°±æ›è¼‰åˆ° window ç­‰å¾…
                window.firebaseReady = true;
        }
        // å°‡ Firebase åŠŸèƒ½æ›è¼‰åˆ°å…¨åŸŸ window ç‰©ä»¶ï¼Œè®“ script.js å¯ä»¥ä½¿ç”¨
        // åœ¨ index.html ä¿®æ”¹é€™å…©å€‹å‡½å¼
        window.saveToFirebase = async function(allData, year, month) {
            try {
                // å‹•æ…‹è·¯å¾‘ï¼šä¾‹å¦‚ NurseSchedule/2026_3
                const docId = `${year}_${month}`;
                await setDoc(doc(db, "NurseSchedule", docId), allData);
                console.log(`âœ… ${docId} è³‡æ–™å·²åŒæ­¥`);
            } catch (e) {
                console.error("åŒæ­¥å¤±æ•—:", e);
            }
        };

        window.loadFromFirebase = async function(year, month) {
            try {
<<<<<<< HEAD
                const docId = `${year}_${month}`;
                const docSnap = await getDoc(doc(db, "NurseSchedule", docId));
                return docSnap.exists() ? docSnap.data() : null;
            } catch (e) {
=======
                const docRef = doc(db, "NurseSchedule", "current");
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    console.log("å¾é›²ç«¯æŠ“åˆ°è³‡æ–™äº†ï¼", docSnap.data());
                    return docSnap.data();
                } else {
                    console.log("é›²ç«¯æ²’æœ‰è³‡æ–™ã€‚");
                    return null;
                }
            } catch (e) {
                console.error("è®€å–å¤±æ•—:", e);
>>>>>>> parent of 043e187 (ä¿®æ­£ç„¡æ³•å­˜å–è³‡æ–™åº«)
                return null;
            }
};
      </script>
</body>
</html>